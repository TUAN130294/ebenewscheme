<!DOCTYPE html>
<html lang="vi">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Salary Calculator - Erablue</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <script>
    tailwind.config = {
      theme: {
        extend: {
          colors: {
            erablue: {
              yellow: '#F7C948',
              'yellow-hover': '#E5B83D',
              dark: '#1a1a2e',
              gray: '#6B7280'
            }
          }
        }
      }
    }
  </script>
  <style>
    @import url('https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap');
    body { font-family: 'Inter', sans-serif; }
    .hero-bg {
      background: linear-gradient(135deg, rgba(247,201,72,0.1) 0%, rgba(255,255,255,0.95) 100%),
                  url('data:image/svg+xml,<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 100 100"><circle cx="20" cy="20" r="15" fill="none" stroke="%23F7C948" stroke-width="0.5" opacity="0.3"/><circle cx="80" cy="30" r="20" fill="none" stroke="%23F7C948" stroke-width="0.5" opacity="0.2"/><circle cx="60" cy="70" r="25" fill="none" stroke="%23F7C948" stroke-width="0.5" opacity="0.25"/></svg>');
      background-size: cover;
    }
    input[type="number"]::-webkit-inner-spin-button,
    input[type="number"]::-webkit-outer-spin-button {
      -webkit-appearance: none;
      margin: 0;
    }
    input[type="number"] { -moz-appearance: textfield; }
    .lang-btn { transition: all 0.2s; }
    .lang-btn.active { background: white; color: #1a1a2e; font-weight: 600; }
  </style>
</head>
<body class="bg-gray-50 min-h-screen">
  <!-- Header -->
  <header class="bg-erablue-yellow shadow-sm">
    <div class="max-w-7xl mx-auto px-4 py-3">
      <div class="flex items-center justify-between">
        <div class="flex items-center gap-3">
          <!-- Erablue Electronics Logo -->
          <img src="logo.png" alt="Erablue Electronics" class="h-12 w-auto">
          <span class="text-gray-800 font-semibold ml-2 hidden md:inline" data-i18n="department">Backend & Business Process Department</span>
        </div>
        <div class="flex items-center">
          <!-- Language Switcher -->
          <div class="flex items-center bg-gray-800/20 rounded-full p-1">
            <button onclick="setLanguage('vi')" class="lang-btn px-3 py-1 rounded-full text-sm active" data-lang="vi">ðŸ‡»ðŸ‡³ VI</button>
            <button onclick="setLanguage('id')" class="lang-btn px-3 py-1 rounded-full text-sm" data-lang="id">ðŸ‡®ðŸ‡© ID</button>
            <button onclick="setLanguage('en')" class="lang-btn px-3 py-1 rounded-full text-sm" data-lang="en">ðŸ‡¬ðŸ‡§ EN</button>
          </div>
        </div>
      </div>
    </div>
  </header>

  <!-- Sub Header -->
  <div class="bg-white border-b py-3">
    <div class="max-w-7xl mx-auto px-4 flex items-center gap-2 text-gray-600">
      <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 7h6m0 10v-3m-3 3h.01M9 17h.01M9 14h.01M12 14h.01M15 11h.01M12 11h.01M9 11h.01M7 21h10a2 2 0 002-2V5a2 2 0 00-2-2H7a2 2 0 00-2 2v14a2 2 0 002 2z"/>
      </svg>
      <span class="font-semibold text-gray-800" data-i18n="salaryCalculator">Salary Calculator</span>
      <span class="text-gray-400">â€”</span>
      <span data-i18n="subTitle">KPI-Based Compensation Calculator</span>
    </div>
  </div>

  <!-- Hero Section -->
  <section class="hero-bg py-12 md:py-16">
    <div class="max-w-7xl mx-auto px-4 text-center">
      <h1 class="text-4xl md:text-5xl font-bold text-gray-800 mb-4" data-i18n="heroTitle">
        Salary Calculator
      </h1>
      <p class="text-gray-600 text-lg max-w-2xl mx-auto" data-i18n="heroDesc">
        Calculate compensation based on KPI achievement with Revenue (70%) and Profit (30%) weighting.
      </p>
    </div>
  </section>

  <!-- Main Calculator -->
  <main class="max-w-6xl mx-auto px-4 py-8 -mt-4">
    <div class="grid lg:grid-cols-3 gap-6">
      
      <!-- Column 1: Level & Salary -->
      <div class="space-y-6">
        <!-- Level Selection -->
        <div class="bg-white rounded-xl shadow-sm border p-6">
          <h2 class="text-lg font-semibold text-gray-800 mb-4 flex items-center gap-2">
            <span class="w-7 h-7 bg-erablue-yellow rounded-full flex items-center justify-center text-sm font-bold text-gray-800">1</span>
            <span data-i18n="selectLevel">Select Level</span>
          </h2>
          <div class="space-y-2" id="levelButtons">
            <button onclick="setLevel('head')" data-level="head" class="level-btn w-full p-4 rounded-lg text-left transition-all border-2 border-gray-200 hover:border-erablue-yellow">
              <div class="flex justify-between items-center">
                <span class="font-semibold text-gray-800">Head</span>
                <span class="text-sm text-gray-500">50% - 200%</span>
              </div>
              <p class="text-sm text-gray-500 mt-1" data-i18n="headDesc">100% Variable - High Risk/High Reward</p>
            </button>
            <button onclick="setLevel('manager')" data-level="manager" class="level-btn w-full p-4 rounded-lg text-left transition-all border-2 border-erablue-yellow bg-erablue-yellow/10">
              <div class="flex justify-between items-center">
                <span class="font-semibold text-gray-800">Manager</span>
                <span class="text-sm text-gray-500">75% - 150%</span>
              </div>
              <p class="text-sm text-gray-500 mt-1" data-i18n="managerDesc">50% Fixed + 50% Variable - Balanced</p>
            </button>
            <button onclick="setLevel('staff')" data-level="staff" class="level-btn w-full p-4 rounded-lg text-left transition-all border-2 border-gray-200 hover:border-erablue-yellow">
              <div class="flex justify-between items-center">
                <span class="font-semibold text-gray-800">Staff</span>
                <span class="text-sm text-gray-500">85% - 130%</span>
              </div>
              <p class="text-sm text-gray-500 mt-1" data-i18n="staffDesc">70% Fixed + 30% Variable - Stable</p>
            </button>
          </div>
        </div>

        <!-- Contract Salary -->
        <div class="bg-white rounded-xl shadow-sm border p-6">
          <h2 class="text-lg font-semibold text-gray-800 mb-4 flex items-center gap-2">
            <span class="w-7 h-7 bg-erablue-yellow rounded-full flex items-center justify-center text-sm font-bold text-gray-800">2</span>
            <span data-i18n="contractSalary">Contract Salary</span>
          </h2>
          <div class="relative">
            <input type="number" id="contractSalary" value="10000000" oninput="calculate()"
              class="w-full text-xl font-semibold p-4 rounded-lg border-2 border-gray-200 focus:border-erablue-yellow focus:outline-none transition-colors">
            <span class="absolute right-4 top-1/2 -translate-y-1/2 text-gray-400 font-medium" id="currencyLabel">VND</span>
          </div>
          <p class="text-sm text-gray-500 mt-2" id="salaryFormatted">= 10,000,000 VND</p>
        </div>
      </div>

      <!-- Column 2: KPI Inputs -->
      <div class="bg-white rounded-xl shadow-sm border p-6">
        <h2 class="text-lg font-semibold text-gray-800 mb-4 flex items-center gap-2">
          <span class="w-7 h-7 bg-erablue-yellow rounded-full flex items-center justify-center text-sm font-bold text-gray-800">3</span>
          <span data-i18n="kpiAchievement">KPI Achievement</span>
        </h2>

        <!-- Revenue -->
        <div class="mb-6">
          <div class="flex justify-between items-center mb-3">
            <label class="font-medium text-gray-700 flex items-center gap-2">
              <span class="text-lg">ðŸ“ˆ</span> <span data-i18n="revenue">Revenue</span>
              <span class="text-xs bg-orange-100 text-orange-600 px-2 py-0.5 rounded-full font-semibold">70%</span>
            </label>
            <span id="revenuePercent" class="text-lg font-bold text-orange-500">80.0%</span>
          </div>
          <div class="grid grid-cols-2 gap-3">
            <div>
              <label class="text-xs text-gray-500 mb-1 block" data-i18n="targetBillion">Target (Billion)</label>
              <input type="number" id="revenueTarget" value="100" oninput="calculate()"
                class="w-full p-3 rounded-lg border-2 border-gray-200 focus:border-orange-400 focus:outline-none transition-colors">
            </div>
            <div>
              <label class="text-xs text-gray-500 mb-1 block" data-i18n="actualBillion">Actual (Billion)</label>
              <input type="number" id="revenueActual" value="80" oninput="calculate()"
                class="w-full p-3 rounded-lg border-2 border-gray-200 focus:border-orange-400 focus:outline-none transition-colors">
            </div>
          </div>
          <!-- Progress bar -->
          <div class="mt-3 h-2 bg-gray-200 rounded-full overflow-hidden">
            <div id="revenueBar" class="h-full bg-gradient-to-r from-orange-400 to-orange-500 transition-all duration-300" style="width: 80%"></div>
          </div>
        </div>

        <!-- Profit -->
        <div>
          <div class="flex justify-between items-center mb-3">
            <label class="font-medium text-gray-700 flex items-center gap-2">
              <span class="text-lg">ðŸ’Ž</span> <span data-i18n="profit">Profit</span>
              <span class="text-xs bg-purple-100 text-purple-600 px-2 py-0.5 rounded-full font-semibold">30%</span>
            </label>
            <span id="profitPercent" class="text-lg font-bold text-purple-500">150.0%</span>
          </div>
          <div class="grid grid-cols-2 gap-3">
            <div>
              <label class="text-xs text-gray-500 mb-1 block" data-i18n="targetBillion">Target (Billion)</label>
              <input type="number" id="profitTarget" value="10" oninput="calculate()"
                class="w-full p-3 rounded-lg border-2 border-gray-200 focus:border-purple-400 focus:outline-none transition-colors">
            </div>
            <div>
              <label class="text-xs text-gray-500 mb-1 block" data-i18n="actualBillion">Actual (Billion)</label>
              <input type="number" id="profitActual" value="15" oninput="calculate()"
                class="w-full p-3 rounded-lg border-2 border-gray-200 focus:border-purple-400 focus:outline-none transition-colors">
            </div>
          </div>
          <!-- Progress bar -->
          <div class="mt-3 h-2 bg-gray-200 rounded-full overflow-hidden">
            <div id="profitBar" class="h-full bg-gradient-to-r from-purple-400 to-purple-500 transition-all duration-300" style="width: 100%"></div>
          </div>
        </div>

        <!-- KPI Formula -->
        <div class="mt-6 p-4 bg-gray-50 rounded-lg border border-gray-200">
          <p class="text-xs text-gray-500 uppercase tracking-wider mb-2" data-i18n="formula">Formula</p>
          <code class="text-sm text-gray-600">
            KPI = (Revenue% Ã— 0.7) + (Profit% Ã— 0.3)
          </code>
        </div>
      </div>

      <!-- Column 3: Results -->
      <div class="space-y-6">
        <!-- KPI Score -->
        <div class="bg-gradient-to-br from-erablue-yellow/20 to-orange-100 rounded-xl shadow-sm border border-erablue-yellow/30 p-6">
          <h3 class="text-sm text-gray-600 mb-1" data-i18n="kpiScore">KPI Score</h3>
          <div class="text-5xl font-bold text-gray-800 mb-4" id="kpiScore">101.0%</div>
          <div class="space-y-2 text-sm">
            <div class="flex justify-between">
              <span class="text-gray-500" data-i18n="revenueContribution">Revenue contribution</span>
              <span class="text-orange-600 font-mono" id="revenueContrib">80% Ã— 70% = 56%</span>
            </div>
            <div class="flex justify-between">
              <span class="text-gray-500" data-i18n="profitContribution">Profit contribution</span>
              <span class="text-purple-600 font-mono" id="profitContrib">150% Ã— 30% = 45%</span>
            </div>
          </div>
        </div>

        <!-- Salary Breakdown -->
        <div class="bg-white rounded-xl shadow-sm border p-6">
          <h3 class="text-lg font-semibold text-gray-800 mb-4" data-i18n="breakdown">Breakdown</h3>
          
          <!-- Visual bar -->
          <div class="h-8 rounded-full overflow-hidden flex bg-gray-100 mb-4" id="salaryBar">
            <div class="bg-green-500 flex items-center justify-center text-xs font-bold text-white transition-all" id="fixedBar" style="width: 50%"><span data-i18n="fixed">Fixed</span></div>
            <div class="bg-blue-500 flex items-center justify-center text-xs font-bold text-white transition-all" id="variableBar" style="width: 50%"><span data-i18n="variable">Variable</span></div>
          </div>

          <div class="space-y-3">
            <div class="flex justify-between items-center p-3 bg-green-50 rounded-lg border border-green-200">
              <div>
                <span class="text-green-700 font-medium" data-i18n="fixedPart">Fixed Part</span>
                <p class="text-xs text-gray-500" id="fixedFormula">10M Ã— 50%</p>
              </div>
              <span class="text-green-700 font-bold" id="fixedAmount">5,000,000</span>
            </div>

            <div class="flex justify-between items-center p-3 bg-blue-50 rounded-lg border border-blue-200">
              <div>
                <span class="text-blue-700 font-medium" data-i18n="variablePart">Variable Part</span>
                <p class="text-xs text-gray-500" id="variableFormula">10M Ã— 50% Ã— 101%</p>
              </div>
              <span class="text-blue-700 font-bold" id="variableAmount">5,050,000</span>
            </div>

            <div class="border-t pt-3">
              <div class="flex justify-between text-gray-500">
                <span data-i18n="rawTotal">Raw Total</span>
                <span class="font-mono" id="rawTotal">10,050,000</span>
              </div>
            </div>

            <!-- Min/Max Range -->
            <div class="bg-gray-50 rounded-lg p-3 border">
              <div class="flex justify-between text-xs text-gray-500 mb-2">
                <span id="minLabel">Floor (75%)</span>
                <span id="maxLabel">Cap (150%)</span>
              </div>
              <div class="relative h-3 bg-gray-200 rounded-full">
                <div class="absolute h-full bg-gradient-to-r from-erablue-yellow to-green-400 rounded-full transition-all" id="rangeBar" style="width: 52%"></div>
                <div class="absolute top-1/2 -translate-y-1/2 w-4 h-4 bg-white rounded-full shadow border-2 border-erablue-yellow transition-all" id="rangeIndicator" style="left: 52%"></div>
              </div>
              <div class="flex justify-between text-xs text-gray-400 mt-1">
                <span id="minAmount">7,500,000</span>
                <span id="maxAmount">15,000,000</span>
              </div>
            </div>
          </div>
        </div>

        <!-- Final Result -->
        <div class="rounded-xl shadow-lg p-6 border-2 transition-all" id="resultCard">
          <div class="flex justify-between items-center mb-2">
            <h3 class="text-sm text-gray-600" data-i18n="finalSalary">Final Salary</h3>
            <span id="capStatus" class="text-xs px-2 py-1 rounded hidden"></span>
          </div>
          <div class="text-4xl font-bold text-gray-800 mb-1" id="finalSalary">10,050,000</div>
          <div class="text-lg text-gray-500" id="currencyDisplay">VND</div>
          <div class="mt-3 flex items-center gap-2">
            <span class="text-2xl font-bold" id="salaryPercent">100.5%</span>
            <span class="text-gray-500" data-i18n="ofContract">of contract</span>
          </div>
        </div>
      </div>
    </div>
  </main>

  <!-- Footer -->
  <footer class="bg-gray-100 border-t py-6 mt-8">
    <div class="max-w-6xl mx-auto px-4 text-center text-gray-500 text-sm">
      <p>Â© 2024 Erablue - <span data-i18n="department">Backend & Business Process Department</span></p>
      <p class="mt-1">KPI Salary Calculator v1.0</p>
    </div>
  </footer>

  <script>
    // Translations
    const translations = {
      vi: {
        department: 'PhÃ²ng Backend & Quy TrÃ¬nh Kinh Doanh',
        salaryCalculator: 'TÃ­nh LÆ°Æ¡ng',
        subTitle: 'TÃ­nh lÆ°Æ¡ng theo KPI',
        heroTitle: 'TÃ­nh LÆ°Æ¡ng Theo KPI',
        heroDesc: 'TÃ­nh toÃ¡n thu nháº­p dá»±a trÃªn KPI vá»›i tá»· trá»ng Doanh Thu (70%) vÃ  Lá»£i Nhuáº­n (30%).',
        selectLevel: 'Chá»n Cáº¥p Báº­c',
        headDesc: '100% Biáº¿n Ä‘á»•i - Rá»§i ro cao/ThÆ°á»Ÿng cao',
        managerDesc: '50% Cá»‘ Ä‘á»‹nh + 50% Biáº¿n Ä‘á»•i - CÃ¢n báº±ng',
        staffDesc: '70% Cá»‘ Ä‘á»‹nh + 30% Biáº¿n Ä‘á»•i - á»”n Ä‘á»‹nh',
        contractSalary: 'LÆ°Æ¡ng Há»£p Äá»“ng',
        kpiAchievement: 'HoÃ n ThÃ nh KPI',
        revenue: 'Doanh Thu',
        profit: 'Lá»£i Nhuáº­n',
        targetBillion: 'Má»¥c tiÃªu (Tá»·)',
        actualBillion: 'Thá»±c táº¿ (Tá»·)',
        formula: 'CÃ´ng Thá»©c',
        kpiScore: 'Äiá»ƒm KPI',
        revenueContribution: 'ÄÃ³ng gÃ³p doanh thu',
        profitContribution: 'ÄÃ³ng gÃ³p lá»£i nhuáº­n',
        breakdown: 'Chi Tiáº¿t',
        fixed: 'Cá»‘ Ä‘á»‹nh',
        variable: 'Biáº¿n Ä‘á»•i',
        fixedPart: 'Pháº§n Cá»‘ Äá»‹nh',
        variablePart: 'Pháº§n Biáº¿n Äá»•i',
        rawTotal: 'Tá»•ng ThÃ´',
        floor: 'SÃ n',
        cap: 'Tráº§n',
        finalSalary: 'LÆ°Æ¡ng Thá»±c Nháº­n',
        ofContract: 'so vá»›i há»£p Ä‘á»“ng',
        floorApplied: 'âš ï¸ Ãp dá»¥ng sÃ n',
        capReached: 'ðŸŽ¯ Äáº¡t tráº§n!',
        currency: 'VND'
      },
      id: {
        department: 'Departemen Backend & Proses Bisnis',
        salaryCalculator: 'Kalkulator Gaji',
        subTitle: 'Kalkulator Kompensasi berbasis KPI',
        heroTitle: 'Kalkulator Gaji',
        heroDesc: 'Hitung kompensasi berdasarkan pencapaian KPI dengan bobot Revenue (70%) dan Profit (30%).',
        selectLevel: 'Pilih Level',
        headDesc: '100% Variabel - Risiko Tinggi/Reward Tinggi',
        managerDesc: '50% Tetap + 50% Variabel - Seimbang',
        staffDesc: '70% Tetap + 30% Variabel - Stabil',
        contractSalary: 'Gaji Kontrak',
        kpiAchievement: 'Pencapaian KPI',
        revenue: 'Revenue',
        profit: 'Profit',
        targetBillion: 'Target (Miliar)',
        actualBillion: 'Aktual (Miliar)',
        formula: 'Rumus',
        kpiScore: 'Skor KPI',
        revenueContribution: 'Kontribusi revenue',
        profitContribution: 'Kontribusi profit',
        breakdown: 'Rincian',
        fixed: 'Tetap',
        variable: 'Variabel',
        fixedPart: 'Bagian Tetap',
        variablePart: 'Bagian Variabel',
        rawTotal: 'Total Mentah',
        floor: 'Lantai',
        cap: 'Plafon',
        finalSalary: 'Gaji Final',
        ofContract: 'dari kontrak',
        floorApplied: 'âš ï¸ Lantai Diterapkan',
        capReached: 'ðŸŽ¯ Plafon Tercapai!',
        currency: 'IDR'
      },
      en: {
        department: 'Backend & Business Process Department',
        salaryCalculator: 'Salary Calculator',
        subTitle: 'KPI-Based Compensation Calculator',
        heroTitle: 'Salary Calculator',
        heroDesc: 'Calculate compensation based on KPI achievement with Revenue (70%) and Profit (30%) weighting.',
        selectLevel: 'Select Level',
        headDesc: '100% Variable - High Risk/High Reward',
        managerDesc: '50% Fixed + 50% Variable - Balanced',
        staffDesc: '70% Fixed + 30% Variable - Stable',
        contractSalary: 'Contract Salary',
        kpiAchievement: 'KPI Achievement',
        revenue: 'Revenue',
        profit: 'Profit',
        targetBillion: 'Target (Billion)',
        actualBillion: 'Actual (Billion)',
        formula: 'Formula',
        kpiScore: 'KPI Score',
        revenueContribution: 'Revenue contribution',
        profitContribution: 'Profit contribution',
        breakdown: 'Breakdown',
        fixed: 'Fixed',
        variable: 'Variable',
        fixedPart: 'Fixed Part',
        variablePart: 'Variable Part',
        rawTotal: 'Raw Total',
        floor: 'Floor',
        cap: 'Cap',
        finalSalary: 'Final Salary',
        ofContract: 'of contract',
        floorApplied: 'âš ï¸ Floor Applied',
        capReached: 'ðŸŽ¯ Cap Reached!',
        currency: 'VND'
      }
    };

    let currentLang = 'vi';

    function setLanguage(lang) {
      currentLang = lang;
      
      // Update language button styles
      document.querySelectorAll('.lang-btn').forEach(btn => {
        btn.classList.remove('active');
        if (btn.dataset.lang === lang) {
          btn.classList.add('active');
        }
      });

      // Update all translated elements
      const t = translations[lang];
      document.querySelectorAll('[data-i18n]').forEach(el => {
        const key = el.dataset.i18n;
        if (t[key]) {
          el.textContent = t[key];
        }
      });

      // Update currency
      document.getElementById('currencyLabel').textContent = t.currency;
      document.getElementById('currencyDisplay').textContent = t.currency;
      
      // Update HTML lang attribute
      document.documentElement.lang = lang;
      
      // Recalculate to update dynamic text
      calculate();
      
      // Save preference
      try { localStorage.setItem('salary-calc-lang', lang); } catch(e) {}
    }

    // Configuration
    const LEVEL_CONFIG = {
      head:    { fixed: 0,   variable: 1,   min: 0.5,  max: 2.0  },
      manager: { fixed: 0.5, variable: 0.5, min: 0.75, max: 1.5  },
      staff:   { fixed: 0.7, variable: 0.3, min: 0.85, max: 1.3  }
    };

    let currentLevel = 'manager';

    function formatNumber(num) {
      return new Intl.NumberFormat('vi-VN').format(Math.round(num));
    }

    function formatPercent(num) {
      return (num * 100).toFixed(1) + '%';
    }

    function setLevel(level) {
      currentLevel = level;
      
      // Update button styles
      document.querySelectorAll('.level-btn').forEach(btn => {
        const isSelected = btn.dataset.level === level;
        btn.className = 'level-btn w-full p-4 rounded-lg text-left transition-all border-2 ' + 
          (isSelected ? 'border-erablue-yellow bg-erablue-yellow/10' : 'border-gray-200 hover:border-erablue-yellow');
      });
      
      calculate();
    }

    function calculate() {
      const config = LEVEL_CONFIG[currentLevel];
      
      // Get values
      const contractSalary = parseFloat(document.getElementById('contractSalary').value) || 0;
      const revenueTarget = parseFloat(document.getElementById('revenueTarget').value) || 1;
      const revenueActual = parseFloat(document.getElementById('revenueActual').value) || 0;
      const profitTarget = parseFloat(document.getElementById('profitTarget').value) || 1;
      const profitActual = parseFloat(document.getElementById('profitActual').value) || 0;

      // Calculate achievements
      const revenueAchievement = revenueActual / revenueTarget;
      const profitAchievement = profitActual / profitTarget;
      
      // KPI Score
      const kpiScore = (revenueAchievement * 0.7) + (profitAchievement * 0.3);
      
      // Salary parts
      const fixedPart = contractSalary * config.fixed;
      const variablePart = contractSalary * config.variable * kpiScore;
      const rawTotal = fixedPart + variablePart;
      
      // Min/Max
      const minSalary = contractSalary * config.min;
      const maxSalary = contractSalary * config.max;
      const finalSalary = Math.min(Math.max(rawTotal, minSalary), maxSalary);
      
      // Check caps
      const isCappedMin = rawTotal < minSalary;
      const isCappedMax = rawTotal > maxSalary;
      const salaryMultiplier = finalSalary / contractSalary;

      // Get current currency
      const currency = translations[currentLang].currency;

      // Update UI
      document.getElementById('salaryFormatted').textContent = '= ' + formatNumber(contractSalary) + ' ' + currency;
      
      // KPI Section
      document.getElementById('revenuePercent').textContent = formatPercent(revenueAchievement);
      document.getElementById('revenuePercent').className = 'text-lg font-bold ' + (revenueAchievement >= 1 ? 'text-green-500' : 'text-orange-500');
      document.getElementById('revenueBar').style.width = Math.min(100, revenueAchievement * 100) + '%';
      
      document.getElementById('profitPercent').textContent = formatPercent(profitAchievement);
      document.getElementById('profitPercent').className = 'text-lg font-bold ' + (profitAchievement >= 1 ? 'text-green-500' : 'text-purple-500');
      document.getElementById('profitBar').style.width = Math.min(100, profitAchievement * 100) + '%';
      
      // KPI Score
      document.getElementById('kpiScore').textContent = formatPercent(kpiScore);
      document.getElementById('revenueContrib').textContent = formatPercent(revenueAchievement) + ' Ã— 70% = ' + formatPercent(revenueAchievement * 0.7);
      document.getElementById('profitContrib').textContent = formatPercent(profitAchievement) + ' Ã— 30% = ' + formatPercent(profitAchievement * 0.3);
      
      // Breakdown
      const fixedWidth = rawTotal > 0 ? (fixedPart / rawTotal) * 100 : 0;
      const variableWidth = rawTotal > 0 ? (variablePart / rawTotal) * 100 : 0;
      
      document.getElementById('fixedBar').style.width = fixedWidth + '%';
      document.getElementById('variableBar').style.width = variableWidth + '%';
      
      document.getElementById('fixedFormula').textContent = formatNumber(contractSalary) + ' Ã— ' + formatPercent(config.fixed);
      document.getElementById('fixedAmount').textContent = formatNumber(fixedPart);
      
      document.getElementById('variableFormula').textContent = formatNumber(contractSalary) + ' Ã— ' + formatPercent(config.variable) + ' Ã— ' + formatPercent(kpiScore);
      document.getElementById('variableAmount').textContent = formatNumber(variablePart);
      
      document.getElementById('rawTotal').textContent = formatNumber(rawTotal);
      
      // Range
      const t = translations[currentLang];
      document.getElementById('minLabel').textContent = t.floor + ' (' + formatPercent(config.min) + ')';
      document.getElementById('maxLabel').textContent = t.cap + ' (' + formatPercent(config.max) + ')';
      document.getElementById('minAmount').textContent = formatNumber(minSalary);
      document.getElementById('maxAmount').textContent = formatNumber(maxSalary);
      
      const rangePosition = Math.min(100, Math.max(0, (salaryMultiplier - config.min) / (config.max - config.min) * 100));
      document.getElementById('rangeBar').style.width = rangePosition + '%';
      document.getElementById('rangeIndicator').style.left = rangePosition + '%';
      
      // Final Result
      document.getElementById('finalSalary').textContent = formatNumber(finalSalary);
      document.getElementById('salaryPercent').textContent = formatPercent(salaryMultiplier);
      document.getElementById('salaryPercent').className = 'text-2xl font-bold ' + (salaryMultiplier >= 1 ? 'text-green-600' : 'text-orange-600');
      
      // Result card styling
      const resultCard = document.getElementById('resultCard');
      const capStatus = document.getElementById('capStatus');
      
      if (isCappedMin) {
        resultCard.className = 'rounded-xl shadow-lg p-6 border-2 transition-all bg-red-50 border-red-300';
        capStatus.textContent = translations[currentLang].floorApplied;
        capStatus.className = 'text-xs px-2 py-1 rounded bg-red-100 text-red-600';
      } else if (isCappedMax) {
        resultCard.className = 'rounded-xl shadow-lg p-6 border-2 transition-all bg-green-50 border-green-300';
        capStatus.textContent = translations[currentLang].capReached;
        capStatus.className = 'text-xs px-2 py-1 rounded bg-green-100 text-green-600';
      } else {
        resultCard.className = 'rounded-xl shadow-lg p-6 border-2 transition-all bg-gradient-to-br from-erablue-yellow/10 to-green-50 border-erablue-yellow/50';
        capStatus.className = 'text-xs px-2 py-1 rounded hidden';
      }
    }

    // Load saved language preference
    try {
      const savedLang = localStorage.getItem('salary-calc-lang');
      if (savedLang && translations[savedLang]) {
        setLanguage(savedLang);
      }
    } catch(e) {}

    // Initial calculation
    calculate();
  </script>
</body>
</html>
